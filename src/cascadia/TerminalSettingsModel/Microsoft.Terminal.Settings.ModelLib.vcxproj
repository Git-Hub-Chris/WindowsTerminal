<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup Label="Globals">
    <ProjectGuid>{CA5CAD1A-d7ec-4107-b7c6-79cb77ae2907}</ProjectGuid>
    <Keyword>Win32Proj</Keyword>
    <ProjectName>Microsoft.Terminal.Settings.Model.Lib</ProjectName>
    <RootNamespace>Microsoft.Terminal.Settings.Model</RootNamespace>
    <TargetName>Microsoft.Terminal.Settings.Model.Lib</TargetName>
    <ConfigurationType>StaticLibrary</ConfigurationType>
    <SubSystem>Console</SubSystem>
    <OpenConsoleUniversalApp>true</OpenConsoleUniversalApp>
  </PropertyGroup>
  <PropertyGroup Label="NuGet Dependencies">
    <TerminalCppWinrt>true</TerminalCppWinrt>
    <TerminalVisualStudioSetup>true</TerminalVisualStudioSetup>
    <TerminalMUX>true</TerminalMUX>
  </PropertyGroup>
  <Import Project="..\..\..\common.openconsole.props" Condition="'$(OpenConsoleDir)'==''" />
  <Import Project="$(OpenConsoleDir)src\common.nugetversions.props" />
  <Import Project="$(OpenConsoleDir)src\cppwinrt.build.pre.props" />
  <!-- ========================= Headers ======================== -->
  <ItemGroup>
    <ClInclude Include="resource.h" />
    <ClInclude Include="ActionArgsMagic.h" />
    <ClInclude Include="NewTabMenuEntry.h">
    </ClInclude>
    <ClInclude Include="SeparatorEntry.h">
    </ClInclude>
    <ClInclude Include="ActionEntry.h">
    </ClInclude>
    <ClInclude Include="FolderEntry.h">
    </ClInclude>
    <ClInclude Include="ProfileEntry.h">
    </ClInclude>
    <ClInclude Include="RemainingProfilesEntry.h">
    </ClInclude>
    <ClInclude Include="ProfileCollectionEntry.h">
    </ClInclude>
    <ClInclude Include="MatchProfilesEntry.h">
    </ClInclude>
    <ClInclude Include="VisualStudioGenerator.h" />
    <ClInclude Include="DefaultTerminal.h">
    </ClInclude>
    <ClInclude Include="pch.h" />
    <ClInclude Include="ActionArgs.h">
    </ClInclude>
    <ClInclude Include="ActionAndArgs.h">
    </ClInclude>
    <ClInclude Include="ActionMap.h">
    </ClInclude>
    <ClInclude Include="AzureCloudShellGenerator.h" />
    <ClInclude Include="ApplicationState.h">
    </ClInclude>
    <ClInclude Include="CascadiaSettings.h">
    </ClInclude>
    <ClInclude Include="ColorScheme.h">
    </ClInclude>
    <ClInclude Include="Theme.h">
    </ClInclude>
    <ClInclude Include="Command.h">
    </ClInclude>
    <ClInclude Include="DynamicProfileUtils.h" />
    <ClInclude Include="FileUtils.h" />
    <ClInclude Include="GlobalAppSettings.h">
    </ClInclude>
    <ClInclude Include="IInheritable.h" />
    <ClInclude Include="MTSMSettings.h" />
    <ClInclude Include="IDynamicProfileGenerator.h" />
    <ClInclude Include="JsonUtils.h" />
    <ClInclude Include="HashUtils.h" />
    <ClInclude Include="KeyChordSerialization.h">
    </ClInclude>
    <ClInclude Include="PowershellCoreProfileGenerator.h" />
    <ClInclude Include="Profile.h">
    </ClInclude>
    <ClInclude Include="AppearanceConfig.h">
    </ClInclude>
    <ClInclude Include="FontConfig.h">
    </ClInclude>
    <ClInclude Include="EnumMappings.h">
    </ClInclude>
    <ClInclude Include="SettingsTypes.h" />
    <ClInclude Include="TerminalSettings.h">
    </ClInclude>
    <ClInclude Include="TerminalSettingsSerializationHelpers.h" />
    <ClInclude Include="TerminalWarnings.h">
    </ClInclude>
    <ClInclude Include="VsDevCmdGenerator.h" />
    <ClInclude Include="VsDevShellGenerator.h" />
    <ClInclude Include="VsSetupConfiguration.h" />
    <ClInclude Include="WslDistroGenerator.h" />
    <ClInclude Include="SshHostGenerator.h" />
    <ClInclude Include="ModelSerializationHelpers.h" />
  </ItemGroup>
  <!-- ========================= Cpp Files ======================== -->
  <ItemGroup>
    <ClCompile Include="VisualStudioGenerator.cpp" />
    <ClCompile Include="DefaultTerminal.cpp">
    </ClCompile>
    <ClCompile Include="init.cpp" />
    <ClCompile Include="pch.cpp">
      <PrecompiledHeader>Create</PrecompiledHeader>
    </ClCompile>
    <ClCompile Include="ActionAndArgs.cpp">
    </ClCompile>
    <ClCompile Include="ActionArgs.cpp">
    </ClCompile>
    <ClCompile Include="ActionMap.cpp">
    </ClCompile>
    <ClCompile Include="ActionMapSerialization.cpp">
    </ClCompile>
    <ClCompile Include="AzureCloudShellGenerator.cpp" />
    <ClCompile Include="ApplicationState.cpp">
    </ClCompile>
    <ClCompile Include="CascadiaSettings.cpp">
    </ClCompile>
    <ClCompile Include="CascadiaSettingsSerialization.cpp">
    </ClCompile>
    <ClCompile Include="ColorScheme.cpp">
    </ClCompile>
    <ClCompile Include="Theme.cpp">
    </ClCompile>
    <ClCompile Include="Command.cpp">
    </ClCompile>
    <ClCompile Include="DynamicProfileUtils.cpp" />
    <ClCompile Include="FileUtils.cpp" />
    <ClCompile Include="GlobalAppSettings.cpp">
    </ClCompile>
    <ClCompile Include="KeyChordSerialization.cpp">
    </ClCompile>
    <ClCompile Include="PowershellCoreProfileGenerator.cpp" />
    <ClCompile Include="Profile.cpp">
    </ClCompile>
    <ClCompile Include="AppearanceConfig.cpp">
    </ClCompile>
    <ClCompile Include="FontConfig.cpp">
    </ClCompile>
    <ClCompile Include="TerminalSettings.cpp">
    </ClCompile>
    <ClCompile Include="EnumMappings.cpp">
    </ClCompile>
    <ClCompile Include="NewTabMenuEntry.cpp">
    </ClCompile>
    <ClCompile Include="SeparatorEntry.cpp">
    </ClCompile>
    <ClCompile Include="ActionEntry.cpp">
    </ClCompile>
    <ClCompile Include="FolderEntry.cpp">
    </ClCompile>
    <ClCompile Include="ProfileEntry.cpp">
    </ClCompile>
    <ClCompile Include="ProfileCollectionEntry.cpp">
    </ClCompile>
    <ClCompile Include="RemainingProfilesEntry.cpp">
    </ClCompile>
    <ClCompile Include="MatchProfilesEntry.cpp">
    </ClCompile>
    <ClCompile Include="VsDevCmdGenerator.cpp" />
    <ClCompile Include="VsDevShellGenerator.cpp" />
    <ClCompile Include="VsSetupConfiguration.cpp" />
    <ClCompile Include="WslDistroGenerator.cpp" />
    <ClCompile Include="SshHostGenerator.cpp" />
    <ClCompile Include="$(GeneratedFilesDir)module.g.cpp" />
  </ItemGroup>
  <!-- ========================= idl Files ======================== -->
  <ItemGroup>
    <Midl Include="Microsoft.Terminal.Settings.Model.idl" />
  </ItemGroup>
  <!-- ========================= Misc Files ======================== -->
  <ItemGroup>
    <PRIResource Include="Resources\en-US\Resources.resw" />
    <OCResourceDirectory Include="Resources" />
  </ItemGroup>
  <ItemGroup>
    <ResourceCompile Include="Microsoft.Terminal.Settings.Model.rc" />
  </ItemGroup>
  <!-- ========================= Project References ======================== -->
  <ItemGroup>
    <!--
      the packaging project won't recurse through our dependencies, you have to
      make sure that if you add a cppwinrt dependency to any of these projects,
      you also update all the consumers
    -->
    <ProjectReference Include="$(OpenConsoleDir)src\types\lib\types.vcxproj" />
    <ProjectReference Include="$(OpenConsoleDir)src\cascadia\WinRTUtils\WinRTUtils.vcxproj">
      <Project>{CA5CAD1A-039A-4929-BA2A-8BEB2E4106FE}</Project>
      <ReferenceOutputAssembly>false</ReferenceOutputAssembly>
    </ProjectReference>
    <ProjectReference Include="$(OpenConsoleDir)src\internal\internal.vcxproj">
      <Project>{ef3e32a7-5ff6-42b4-b6e2-96cd7d033f00}</Project>
    </ProjectReference>

    <!-- For whatever reason, we can't include the TerminalControl and
    TerminalSettings projects' winmds via project references. So we'll have to
    manually include the winmds as References below

    BODGY: we do need to add a ProjectReference to TerminalControl.vcxproj,
    with Private=true, ReferenceOutputAssembly=false, so that Visual Studio's
    "Fast Up-to-date Check" will work with this project. If we don't, the Fast
    Up-to-date Check will look for the .xaml files from that project in our
    output, which won't actually be there.

    We do still need to separately reference the winmds manually below, which is annoying.
    -->

    <ProjectReference Include="$(OpenConsoleDir)src\cascadia\TerminalControl\dll\TerminalControl.vcxproj">
      <!-- Private:true and ReferenceOutputAssembly:false, in combination with
      the manual reference to TerminalControl.winmd below make sure that this
      project will compile correct, and that we won't roll up the TermControl
      xbf's into the packaging project twice. -->
      <Private>true</Private>
      <ReferenceOutputAssembly>false</ReferenceOutputAssembly>
    </ProjectReference>

  </ItemGroup>
  <ItemGroup>
    <!-- Manually add references to each of our dependent winmds. Mark them as private=false and CopyLocalSatelliteAssemblies=false, so that we don't
    propagate them upwards (which can make referencing this project result in
    duplicate type definitions)-->
    <Reference Include="Microsoft.Terminal.TerminalConnection">
      <HintPath>$(OpenConsoleCommonOutDir)TerminalConnection\Microsoft.Terminal.TerminalConnection.winmd</HintPath>
      <IsWinMDFile>true</IsWinMDFile>
      <Private>false</Private>
      <CopyLocalSatelliteAssemblies>false</CopyLocalSatelliteAssemblies>
    </Reference>
    <Reference Include="Microsoft.Terminal.Control">
      <HintPath>$(OpenConsoleCommonOutDir)Microsoft.Terminal.Control\Microsoft.Terminal.Control.winmd</HintPath>
      <IsWinMDFile>true</IsWinMDFile>
      <Private>false</Private>
      <CopyLocalSatelliteAssemblies>false</CopyLocalSatelliteAssemblies>
    </Reference>
    <Reference Include="Microsoft.Terminal.Core">
      <HintPath>$(OpenConsoleCommonOutDir)TerminalCore\Microsoft.Terminal.Core.winmd</HintPath>
      <IsWinMDFile>true</IsWinMDFile>
      <Private>false</Private>
      <CopyLocalSatelliteAssemblies>false</CopyLocalSatelliteAssemblies>
    </Reference>
  </ItemGroup>
  <!-- ====================== Compiler & Linker Flags ===================== -->
  <ItemDefinitionGroup>
    <ClCompile>
      <PrecompiledHeaderFile>pch.h</PrecompiledHeaderFile>
      <AdditionalIncludeDirectories>..;%(AdditionalIncludeDirectories);</AdditionalIncludeDirectories>
      <!-- Manually disable unreachable code warning, because jconcpp has a ton of that. -->
      <DisableSpecificWarnings>4702;%(DisableSpecificWarnings)</DisableSpecificWarnings>
    </ClCompile>
    <Link>
      <AdditionalDependencies>%(AdditionalDependencies);user32.lib</AdditionalDependencies>
    </Link>
    <Reference>
      <Private>false</Private>
    </Reference>
  </ItemDefinitionGroup>
  <!-- ========================= Globals ======================== -->
  <Import Project="$(OpenConsoleDir)src\cppwinrt.build.post.props" />
  <Import Project="$(OpenConsoleDir)src\common.nugetversions.targets" />

  <!-- PowerShell version check, outputs error if the wrong version is installed. -->
  <Import Project="$(SolutionDir)build\rules\CollectWildcardResources.targets" />
  <Target Name="BeforeResourceCompile" Inputs="defaults.json;userDefaults.json;enableColorSelection.json" Outputs="Generated Files\defaults.json;Generated Files\userDefaults.json;Generated Files\enableColorSelection.json">
    <Exec Command="powershell.exe -NoProfile -ExecutionPolicy Unrestricted -File &quot;$(OpenConsoleDir)\tools\WindowsCheckPSVersion.ps1&quot;" />
    <Exec Command="pwsh.exe -NoProfile -ExecutionPolicy Unrestricted &quot;$(OpenConsoleDir)\tools\CheckPSVersion.ps1&quot;" />
    <Exec Command="pwsh.exe -NoProfile -ExecutionPolicy Unrestricted &quot;$(OpenConsoleDir)\tools\CompressJson.ps1&quot; -JsonFile defaults.json -OutPath &quot;Generated Files\defaults.json&quot;" />
    <Exec Command="pwsh.exe -NoProfile -ExecutionPolicy Unrestricted &quot;$(OpenConsoleDir)\tools\CompressJson.ps1&quot; -JsonFile userDefaults.json -OutPath &quot;Generated Files\userDefaults.json&quot;" />
    <Exec Command="pwsh.exe -NoProfile -ExecutionPolicy Unrestricted &quot;$(OpenConsoleDir)\tools\CompressJson.ps1&quot; -JsonFile enableColorSelection.json -OutPath &quot;Generated Files\enableColorSelection.json&quot;" />
  </Target>

</Project>
